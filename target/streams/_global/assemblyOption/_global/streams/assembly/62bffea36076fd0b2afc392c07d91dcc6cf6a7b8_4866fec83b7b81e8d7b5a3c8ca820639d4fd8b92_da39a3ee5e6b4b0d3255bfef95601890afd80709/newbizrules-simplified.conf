simplifiedrules {
    catalogs {
    }

    channels {
        WEB {
            placements {
                banner {
                    provider: "enablereactivacionpipeline"
                }
                resumendecuenta {
                    provider: "resumendecuentapipeline"
                }
                paginadeexito {
                    provider: "productosfinancierospipeline"
                }
                ALLRECS {
                    provider: "modeloproductosfinancieros"
                    recsNeeded: 1000
                }
                fallback {
                  provider: "fallback_provider"
                }
            }
        }
        BATCH {
            placements {
                ALLRECS {
                    provider: "productosfinancierospipeline"
                    recsNeeded: 1000
                }
                fallback {
                    provider: "fallback_provider"
                }
            }
        }
    }

    providers {

        repactacion {
          providerType: "OrderedList"
          list: ["REPACTACION"]
        }

        acciones_reactivacion {
          providerType: "OrderedList"
          list: ["REACTIVACION"]
        }

        modeloproductosfinancieros {
          providerType: "PredictionModel"
          modelName: "singleclassificationmodel"
        }

        productosfinancierospipeline {
          providerType: "Pipeline"
          providers: [
            {
              name: "modeloproductosfinancieros"
              recsNeeded: 1
              recsPriority: 0
            },
            {
              name: "default"
              recsNeeded: 1
              recsPriority: 0
            }
          ]
        }

        enablereactivacionpipeline {
          providerType: "Pipeline"
          providers: [
            {
              name: "acciones_reactivacion"
              recsNeeded: 1
              recsPriority: 0
            },
            {
              name: "productosfinancierospipeline",
              recsNeeded: 1
              recsPriority: 0
            }
          ]
        }

        resumendecuentapipeline {
          providerType: "Pipeline"
          providers: [
            {
              name: "repactacion"
              recsNeeded: 1
              recsPriority: 0
            },
            {
              name: "modeloproductosfinancieros"
              recsNeeded: 1
              recsPriority: 1
            },
            {
              name: "default"
              recsNeeded: 1
              recsPriority: 0
            }
          ]
        }

        default {
          providerType: "OrderedList"
          list: ["PAT"]
        }

        fallback_provider {
            providerType: "OrderedList"
            list: ["PAT"]
        }
    }

    rules: [

      # Super Avance --------------------------------------------------
      {
        "channels": [],
        "classname": "EventDecay",
        "id": "regla-decaimiento-sae",
        "placements": [],
        "product": "SUPER_AVANCE",
        "blockIfNotPresent": true,
        "affectedProducts": [],
        "taoProfile": {
          "classname": "ShortTerm"
        }
        "offsetProfile": {
          "classname": "MediumImpact"
        }
      },
      {
        "id": "reglas-sae",
        "classname": "SimpleExpression",
        "ruleAction": {
          "classname": "EnableAction"
        }
        "affectedProducts": ["SUPER_AVANCE"],
        "expression": "(m3 or m6) and saeAmount > 0"
      },
      {
        "affectedProducts": ["SUPER_AVANCE"],
        "channels": [],
        "classname": "AddArg",
        "discardIfNotPresent": true,
        "id": "add-monto-super-avance",
        "inputParameterExpression": {
          "classname": "ConstantExpression",
          "name": "saeAmount"
        },
        "last": false,
        "placements": [],
        "targetArgExpression": {
          "classname": "ConstantExpression",
          "name": "monto"
        }
      },
      {
        "affectedProducts": [
          "SUPER_AVANCE"
        ],
        "channels": [],
        "classname": "ExtradataRule",
        "extradataName": "SAE099",
        "id": "sae099",
        "last": false,
        "placements": [],
        "ruleAction": {
          "classname": "TransformAction",
          "targetProduct": "SAE099"
        }
      },
      {
        "affectedProducts": [
          "SUPER_AVANCE"
        ],
        "channels": [],
        "classname": "ExtradataRule",
        "extradataName": "SAE089",
        "id": "sae089",
        "last": false,
        "placements": [],
        "ruleAction": {
          "classname": "TransformAction",
          "targetProduct": "SAE089"
        }
      },
      {
        "affectedProducts": [
          "SUPER_AVANCE"
        ],
        "channels": [],
        "classname": "ExtradataRule",
        "extradataName": "SAE079",
        "id": "sae079",
        "last": false,
        "placements": [],
        "ruleAction": {
          "classname": "TransformAction",
          "targetProduct": "SAE079"
        }
      },

      # Avance de caja ----------------------------------------------
      {
        "channels": [],
        "classname": "EventDecay",
        "id": "regla-decaimiento-ae",
        "placements": [],
        "product": "AVANCE_CAJA",
        "blockIfNotPresent": true,
        "affectedProducts": [],
        "taoProfile": {
          "classname": "ShortTerm"
        }
        "offsetProfile": {
          "classname": "MediumImpact"
        }
      },
      {
        "id": "reglas-ae",
        "classname": "SimpleExpression",
        "ruleAction": {
          "classname": "EnableAction"
        }
        "affectedProducts": ["AVANCE_CAJA"],
        "expression": "(m2 or m5) and aeAmount >= 50000"
      },
      {
        "affectedProducts": ["AVANCE_CAJA"],
        "channels": [],
        "classname": "AddArg",
        "discardIfNotPresent": true,
        "id": "add-monto-avance-caja",
        "inputParameterExpression": {
          "classname": "ConstantExpression",
          "name": "aeAmount"
        },
        "last": false,
        "placements": [],
        "targetArgExpression": {
          "classname": "ConstantExpression",
          "name": "monto"
        }
      },

      # Traspaso --------------------------------------------
      {
        "channels": [],
        "classname": "EventDecay",
        "id": "regla-decaimiento-traspaso",
        "placements": [],
        "product": "TRASPASO",
        "blockIfNotPresent": true,
        "affectedProducts": [],
        "taoProfile": {
          "classname": "LongTerm"
        }
        "offsetProfile": {
          "classname": "HighImpact"
        }
      },
      {
        "affectedProducts": [
          "TRASPASO",
          "TRASPASO_TARJETA_CERRADA",
          "TRASPASO_TARJETA_ABIERTA"
        ],
        "channels": [],
        "classname": "SimpleRenameProduct",
        "id": "rename-traspasos",
        "last": false,
        "placements": [],
        "targetProductExpression": {
          "classname": "ConstantExpression",
          "name": "TRASPASO"
        }
      },
      {
        "id": "reglas-traspaso",
        "classname": "SimpleExpression",
        "ruleAction": {
          "classname": "EnableAction"
        }
        "affectedProducts": ["TRASPASO"],
        "expression": "m1 and !m7 and !con_tarjetas_abiertas"
      },
      {
        "affectedProducts": [
          "TRASPASO"
        ],
        "channels": [],
        "classname": "AddArg",
        "discardIfNotPresent": true,
        "id": "add-monto-traspaso",
        "inputParameterExpression": {
          "classname": "ConstantExpression",
          "name": "cardAmount"
        },
        "last": false,
        "placements": [],
        "targetArgExpression": {
          "classname": "ConstantExpression",
          "name": "monto"
        }
      },

      # Aumento de cupo -----------------------------------
      {
        "channels": [],
        "classname": "EventDecay",
        "id": "regla-decaimiento-aumentocupo",
        "placements": [],
        "product": "AUMENTO_CUPO",
        "blockIfNotPresent": true,
        "affectedProducts": [],
        "taoProfile": {
          "classname": "LongTerm"
        }
        "offsetProfile": {
          "classname": "HighImpact"
        }
      },
      {
        "id": "reglas-aumentocupo",
        "classname": "SimpleExpression",
        "ruleAction": {
          "classname": "EnableAction"
        }
        "affectedProducts": ["AUMENTO_CUPO"],
        "expression": "m1 or m4"
      },
      {
        "affectedProducts": [
          "AUMENTO_CUPO"
        ],
        "channels": [],
        "classname": "ExtradataRule",
        "extradataName": "AUM",
        "id": "aumento_cupo",
        "last": true,
        "placements": [],
        "ruleAction": {
          "classname": "EnableAction"
        }
      },


      # Repactación -------------------------------------
      {
        "channels": [],
        "classname": "SimplePushDown",
        "distance": 0.6,
        "id": "pushdown-repactacion",
        "placements": [],
        "product": "REPACTACION",
        "affectedProducts": []
      },
      {
        "channels": [],
        "classname": "EventDecay",
        "id": "regla-decaimiento-repa",
        "placements": [],
        "product": "REPACTACION",
        "blockIfNotPresent": true,
        "affectedProducts": [],
        "taoProfile": {
          "classname": "ShortTerm"
        }
        "offsetProfile": {
          "classname": "LowImpact"
        }
      },
      {
        "id": "reglas-repactacion",
        "classname": "SimpleExpression",
        "ruleAction": {
          "classname": "EnableAction"
        }
        "affectedProducts": ["REPACTACION"],
        "expression": "(m1 or m4) and enableREPACTACION"
      },
      {
        "id": "recenciaREPA",
        "classname": "DateRule",
        "blockIfNotPresent": "false",
        "affectedProducts": ["REPACTACION"],
        "parameterExpression": {
          "classname": "ConstantExpression",
          "name": "recencias_fechaUltimoREPACTACION"
        },
        "dateValidation": {
          "classname": "SameMonth",
          "shouldBeTrue": false
        }
      },
      {
        "affectedProducts": [
          "REPACTACION"
        ],
        "channels": [],
        "classname": "ExtradataRule",
        "extradataName": "REP",
        "id": "repactacion",
        "last": false,
        "placements": [],
        "ruleAction": {
          "classname": "EnableAction"
        }
      },


      # Reactivación -------------------------------------------------------------
      {
        "id": "reglas-reactivacion",
        "classname": "SimpleExpression",
        "ruleAction": {
          "classname": "EnableAction"
        }
        "affectedProducts": ["REACTIVACION"],
        "expression": "(m1 or m4) and inactivo"
      },

      # Adicionaes -------------------------------------------------------------
      {
        "channels": [],
        "classname": "SimplePushDown",
        "distance": 0.7,
        "id": "pushdown-adicionales",
        "placements": [],
        "product": "ADICIONAL",
        "affectedProducts": []
      },
      {
        "channels": [],
        "classname": "EventDecay",
        "id": "regla-decaimiento-adicional",
        "placements": [],
        "product": "ADICIONAL",
        "blockIfNotPresent": true,
        "affectedProducts": [],
        "taoProfile": {
          "classname": "LongTerm"
        }
        "offsetProfile": {
          "classname": "HighImpact"
        }

      },
      {
        "id": "reglas-adicional",
        "classname": "SimpleExpression",
        "ruleAction": {
          "classname": "EnableAction"
        }
        "affectedProducts": ["ADICIONAL"],
        "expression": "m4 and con_tarjetas_abiertas and cantidad_adicionales = 0"
      }

    ]
}