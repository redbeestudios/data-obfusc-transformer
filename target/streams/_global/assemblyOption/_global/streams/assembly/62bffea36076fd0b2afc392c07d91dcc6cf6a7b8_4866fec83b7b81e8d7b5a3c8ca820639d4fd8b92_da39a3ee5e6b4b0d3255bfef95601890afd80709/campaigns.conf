campaigns {

  tasas-sae {
    jobname = "tasasSAE"
    consumer-conf { include "default-campaign-consumer.conf" }
    datasource {
      backfill_query = "SELECT * FROM DL_SI_DIM_VW.TABLA_TASAS_SAE_ONE ORDER BY FECHA_ACTUALIZACION ASC"
      delta_query = "SELECT * FROM DL_SI_DIM_VW.TABLA_TASAS_SAE_ONE WHERE FECHA_ACTUALIZACION > ?  ORDER BY FECHA_ACTUALIZACION ASC"
      count_backfill_query = "SELECT count(1) AS quantity, FECHA_ACTUALIZACION FROM (SELECT * FROM DL_SI_DIM_VW.TABLA_TASAS_SAE_ONE ) query GROUP BY FECHA_ACTUALIZACION"
      count_delta_query = "SELECT count(1) as quantity, FECHA_ACTUALIZACION FROM (SELECT *  FROM DL_SI_DIM_VW.TABLA_TASAS_SAE_ONE WHERE FECHA_ACTUALIZACION > ?) query GROUP BY FECHA_ACTUALIZACION"
      deltaname = "fecha_actualizacion"
      dbname = "DL_SI_DIM_VW"
      tablename = "TABLA_TASAS_SAE_ONE"
      rut-field = "documento_identificacion"

    }

  }

  sae-campaign {
    jobname = "cargaSAE"
    consumer-conf { include "default-campaign-consumer.conf" }
    datasource {
      backfill_query = "SELECT cli.documento_identificacion, adm.id_segmento, adm.id_afinidad_cliente, adm.fecha_ult_actualizacion FROM admmcta.mcta_maestro_cuenta adm INNER JOIN admmcli.mcli_cliente cli ON cli.id_cliente = adm.id_cliente ORDER BY fecha_ult_actualizacion ASC"
      delta_query = "SELECT cli.documento_identificacion, adm.id_segmento, adm.id_afinidad_cliente, adm.fecha_ult_actualizacion FROM admmcta.mcta_maestro_cuenta adm INNER JOIN admmcli.mcli_cliente cli ON cli.id_cliente = adm.id_cliente WHERE TO_TIMESTAMP(adm.fecha_ult_actualizacion::TEXT, 'YYYY/MM/DD HH24:MI:SS') > TO_TIMESTAMP(?, 'YYYY/MM/DD HH24:MI:SS') ORDER BY fecha_ult_actualizacion ASC "
      count_backfill_query = "SELECT count(1) AS quantity, fecha_ult_actualizacion FROM (SELECT cli.documento_identificacion, adm.id_segmento, adm.id_afinidad_cliente, adm.fecha_ult_actualizacion FROM admmcta.mcta_maestro_cuenta adm INNER JOIN admmcli.mcli_cliente cli ON cli.id_cliente = adm.id_cliente) query GROUP BY fecha_ult_actualizacion"
      count_delta_query = "SELECT count(1) as quantity, fecha_ult_actualizacion FROM (SELECT cli.documento_identificacion, adm.id_segmento, adm.id_afinidad_cliente, adm.fecha_ult_actualizacion FROM admmcta.mcta_maestro_cuenta adm INNER JOIN admmcli.mcli_cliente cli ON cli.id_cliente = adm.id_cliente WHERE TO_TIMESTAMP(adm.fecha_ult_actualizacion::TEXT, 'YYYY/MM/DD HH24:MI:SS') > TO_TIMESTAMP(?, 'YYYY/MM/DD HH24:MI:SS')) query GROUP BY fecha_ult_actualizacion"
      deltaname = "fecha_ult_actualizacion"
      dbname = "DL_SI_DIM_VW"
      rut-field = "documento_identificacion"
      tablename = "mcta_maestro_cuenta"
    }

  }

afinidad-campaign {
    jobname = "cargaAfinidad"
    consumer-conf {
      min-backoff = 3 second
      max-backoff = 30 second
      random-factor = 0.2
      max-restarts = 100
      poll-interval = 2000
      parallelism = 1
      batch-size = 1000
      batch-timeout = 3000
    }
    datasource {
      backfill_query = "SELECT cli.documento_identificacion AS rut, max((afi.codigo)::text) AS afinidad, max(adm.fecha_ult_actualizacion) AS ultima_modificacion FROM ((admmcta.mcta_maestro_cuenta adm JOIN admmcli.mcli_cliente cli ON ((cli.id_cliente = adm.id_cliente))) JOIN admmref.mref_afinidad_cliente afi ON ((afi.id = adm.id_afinidad_cliente))) WHERE (((afi.codigo)::text <> '99'::text) AND (adm.fecha_ult_actualizacion IS NOT NULL)) GROUP BY cli.documento_identificacion;"
      delta_query = "SELECT updated.documento_identificacion AS rut, max((afi.codigo)::text) AS afinidad, max(mc.fecha_ult_actualizacion) AS ultima_modificacion FROM (admmcta.mcta_maestro_cuenta mc join (select mcli.id_cliente, mcli.documento_identificacion from admmcta.mcta_maestro_cuenta mcta JOIN admmcli.mcli_cliente mcli on mcli.id_cliente = mcta.id_cliente WHERE TO_TIMESTAMP(mcta.fecha_ult_actualizacion::TEXT, 'YYYY/MM/DD HH24:MI:SS') > TO_TIMESTAMP(?, 'YYYY/MM/DD HH24:MI:SS')) updated on updated.id_cliente = mc.id_cliente JOIN admmref.mref_afinidad_cliente afi ON ((afi.id = mc.id_afinidad_cliente))) WHERE (((afi.codigo)::text <> '99'::text) AND (mc.fecha_ult_actualizacion IS NOT NULL)) GROUP BY updated.documento_identificacion"
      count_backfill_query = "select count(1) as quantity, min(ultima_modificacion) AS ultima_modificacion from (SELECT cli.documento_identificacion AS rut, max((afi.codigo)::text) AS afinidad, max(adm.fecha_ult_actualizacion) AS ultima_modificacion FROM ((admmcta.mcta_maestro_cuenta adm JOIN admmcli.mcli_cliente cli ON ((cli.id_cliente = adm.id_cliente))) JOIN admmref.mref_afinidad_cliente afi ON ((afi.id = adm.id_afinidad_cliente))) WHERE (((afi.codigo)::text <> '99'::text) AND (adm.fecha_ult_actualizacion IS NOT NULL)) GROUP BY cli.documento_identificacion) t0"
      count_delta_query = " select count(1) as quantity, coalesce(min(ultima_modificacion), TO_TIMESTAMP(?, 'YYYY/MM/DD HH24:MI:SS')) AS ultima_modificacion from ( SELECT updated.documento_identificacion AS rut, max((afi.codigo)::text) AS afinidad, max(mc.fecha_ult_actualizacion) AS ultima_modificacion FROM (admmcta.mcta_maestro_cuenta mc join (select mcli.id_cliente, mcli.documento_identificacion from admmcta.mcta_maestro_cuenta mcta join admmcli.mcli_cliente mcli on mcli.id_cliente = mcta.id_cliente WHERE TO_TIMESTAMP(mcta.fecha_ult_actualizacion::TEXT, 'YYYY/MM/DD HH24:MI:SS') > TO_TIMESTAMP(?, 'YYYY/MM/DD HH24:MI:SS')) updated on updated.id_cliente = mc.id_cliente JOIN admmref.mref_afinidad_cliente afi ON ((afi.id = mc.id_afinidad_cliente))) WHERE (((afi.codigo)::text <> '99'::text) AND (mc.fecha_ult_actualizacion IS NOT NULL)) GROUP BY updated.documento_identificacion) t0"
      deltaname = "ultima_modificacion"
      dbname = "DL_SI_DIM_VW"
      rut-field = "rut"
      tablename = "peor_afinidad"
    }

  }

  repactacion-campaign {
    jobname = "cargaRepactacion"
    consumer-conf { include "default-campaign-consumer.conf" }
    datasource {
      backfill_query = "SELECT rut, fecha FROM  DL_RG_CRM.cat_rg_OFERTA_REPA_AL_DIA ORDER BY fecha ASC"
      delta_query = "SELECT rut, fecha FROM  DL_RG_CRM.cat_rg_OFERTA_REPA_AL_DIA WHERE fecha > ? ORDER BY fecha ASC"
      count_backfill_query = "SELECT count(1) as quantity, fecha FROM (SELECT rut, fecha FROM  DL_RG_CRM.cat_rg_OFERTA_REPA_AL_DIA) query GROUP BY fecha"
      count_delta_query = "SELECT count(1) as quantity, fecha FROM (SELECT rut, fecha FROM  DL_RG_CRM.cat_rg_OFERTA_REPA_AL_DIA WHERE fecha > ?) query GROUP BY fecha"
      deltaname = "fecha"
      dbname = "DL_SI_DIM_VW"
      rut-field = "rut"
      tablename = "cat_rg_OFERTA_REPA_AL_DIA"
    }

  }

  renovacion-campaign {
    jobname = "cargaRenovacion"
    consumer-conf { include "default-campaign-consumer.conf" }
    datasource {
      backfill_query = "SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_RENOVACIONPLASTICO_OFERTADOR_TAC ORDER BY fecha_registro ASC"
      delta_query = "SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_RENOVACIONPLASTICO_OFERTADOR_TAC WHERE fecha_registro > ? ORDER BY fecha_registro ASC"
      count_backfill_query = "SELECT count(1) as quantity, fecha_registro FROM (SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_RENOVACIONPLASTICO_OFERTADOR_TAC) query GROUP BY fecha_registro"
      count_delta_query = "SELECT count(1) as quantity, fecha_registro FROM (SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_RENOVACIONPLASTICO_OFERTADOR_TAC WHERE fecha_registro > ?) query GROUP BY fecha_registro"
      deltaname = "fecha_registro"
      dbname = "DL_SI_DIM_VW"
      rut-field = "rut"
      tablename = "TMP_RENOVACIONPLASTICO_OFERTADOR_TAC"
    }
  }

  apertura-campaign {
    jobname = "cargaApertura"
    consumer-conf { include "default-campaign-consumer.conf" }
    datasource {
      backfill_query = "SELECT rut, fecha_registro, monto, tipo_producto FROM DL_SI_DIM_VW.TMP_CAPTA_OFERTADOR_TAC ORDER BY fecha_registro ASC"
      delta_query = "SELECT rut, fecha_registro, monto, tipo_producto FROM DL_SI_DIM_VW.TMP_CAPTA_OFERTADOR_TAC WHERE fecha_registro > ? ORDER BY fecha_registro ASC"
      count_backfill_query = "SELECT count(1) as quantity, fecha_registro FROM (SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_CAPTA_OFERTADOR_TAC) query GROUP BY fecha_registro"
      count_delta_query = "SELECT count(1) as quantity, fecha_registro FROM (SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_CAPTA_OFERTADOR_TAC WHERE fecha_registro > ?) query GROUP BY fecha_registro"
      deltaname = "fecha_registro"
      dbname = "DL_SI_DIM_VW"
      rut-field = "rut"
      tablename = "TMP_CAPTA_OFERTADOR_TAC"
    }
  }

  enrolamiento-campaign {
    jobname = "cargaEnrolamiento"
    consumer-conf { include "default-campaign-consumer.conf" }
    datasource {
      backfill_query = "SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_ENROLADOS_OFERTADOR_TAC ORDER BY fecha_registro ASC"
      delta_query = "SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_ENROLADOS_OFERTADOR_TAC WHERE fecha_registro > ? ORDER BY fecha_registro ASC"
      count_backfill_query = "SELECT count(1) as quantity, fecha_registro FROM (SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_ENROLADOS_OFERTADOR_TAC) query GROUP BY fecha_registro"
      count_delta_query = "SELECT count(1) as quantity, fecha_registro FROM (SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_ENROLADOS_OFERTADOR_TAC WHERE fecha_registro >= ?) query GROUP BY fecha_registro"
      deltaname = "fecha_registro"
      dbname = "DL_SI_DIM_VW"
      rut-field = "rut"
      tablename = "TMP_ENROLADOS_OFERTADOR_TAC"
    }
  }

  reemision-campaign {
    jobname = "cargaReemision"
    consumer-conf { include "default-campaign-consumer.conf" }
    datasource {
      backfill_query = "SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_TRASPASOCHIP_OFERTADOR_TAC ORDER BY fecha_registro ASC"
      delta_query = "SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_TRASPASOCHIP_OFERTADOR_TAC WHERE fecha_registro > ? ORDER BY fecha_registro ASC"
      count_backfill_query = "SELECT count(1) as quantity, fecha_registro FROM (SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_TRASPASOCHIP_OFERTADOR_TAC) query GROUP BY fecha_registro"
      count_delta_query = "SELECT count(1) as quantity, fecha_registro FROM (SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_TRASPASOCHIP_OFERTADOR_TAC WHERE fecha_registro > ?) query GROUP BY fecha_registro"
      deltaname = "fecha_registro"
      dbname = "DL_SI_DIM_VW"
      rut-field = "rut"
      tablename = "TMP_TRASPASOCHIP_OFERTADOR_TAC"
    }
  }

  repactacion-totem-campaign {
    jobname = "cargaRepactacionTotem"
    consumer-conf { include "default-campaign-consumer.conf" }
    datasource {
      backfill_query = "SELECT rut, fecha_registro, monto FROM DL_SI_DIM_VW.TMP_REPA_OFERTADOR_TAC ORDER BY fecha_registro ASC"
      delta_query = "SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_RENOVACIONPLASTICO_OFERTADOR_TAC WHERE fecha_registro > ? ORDER BY fecha_registro ASC"
      count_backfill_query = "SELECT count(1) as quantity, fecha_registro FROM (SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_REPA_OFERTADOR_TAC) query GROUP BY fecha_registro"
      count_delta_query = "SELECT count(1) as quantity, fecha_registro FROM (SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_REPA_OFERTADOR_TAC WHERE fecha_registro >= ?) query GROUP BY fecha_registro"
      deltaname = "fecha_registro"
      dbname = "DL_SI_DIM_VW"
      rut-field = "rut"
      tablename = "TMP_REPA_OFERTADOR_TAC"
    }
  }

  sae-totem-campaign {
    jobname = "cargaSAETotem"
    consumer-conf { include "default-campaign-consumer.conf" }
    datasource {
      backfill_query = "SELECT rut, fecha_registro, monto FROM DL_SI_DIM_VW.TMP_SAE_OFERTADOR_TAC ORDER BY fecha_registro ASC"
      delta_query = "SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_SAE_OFERTADOR_TAC WHERE fecha_registro > ? ORDER BY fecha_registro ASC"
      count_backfill_query = "SELECT count(1) as quantity, fecha_registro FROM (SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_SAE_OFERTADOR_TAC) query GROUP BY fecha_registro"
      count_delta_query = "SELECT count(1) as quantity, fecha_registro FROM (SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_SAE_OFERTADOR_TAC WHERE fecha_registro >= ?) query GROUP BY fecha_registro"
      deltaname = "fecha_registro"
      dbname = "DL_SI_DIM_VW"
      rut-field = "rut"
      tablename = "TMP_SAE_OFERTADOR_TAC"
    }
  }

  seguro-auto-campaign {
    jobname = "cargaSeguroAuto"
    consumer-conf { include "default-campaign-consumer.conf" }
    datasource {
      backfill_query = "SELECT rut, fecha_registro, marca, modelo FROM DL_SI_DIM_VW.TMP_SEGAUTO_OFERTADOR_TAC ORDER BY fecha_registro ASC"
      delta_query = "SELECT rut, fecha_registro, marca, modelo FROM DL_SI_DIM_VW.TMP_SEGAUTO_OFERTADOR_TAC WHERE fecha_registro > ? ORDER BY fecha_registro ASC"
      count_backfill_query = "SELECT count(1) as quantity, fecha_registro FROM (SELECT rut, fecha_registro, marca, modelo FROM DL_SI_DIM_VW.TMP_SEGAUTO_OFERTADOR_TAC) query GROUP BY fecha_registro"
      count_delta_query = "SELECT count(1) as quantity, fecha_registro FROM (SELECT rut, fecha_registro, marca, modelo FROM DL_SI_DIM_VW.TMP_SEGAUTO_OFERTADOR_TAC WHERE fecha_registro > ?) query GROUP BY fecha_registro"
      deltaname = "fecha_registro"
      dbname = "DL_SI_DIM_VW"
      rut-field = "rut"
      tablename = "TMP_SEGAUTO_OFERTADOR_TAC"
    }
  }

  seguro-vida-campaign {
    jobname = "cargaSeguroVida"
    consumer-conf { include "default-campaign-consumer.conf" }
    datasource {
      backfill_query = "SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_SEGVIDA_OFERTADOR_TAC ORDER BY fecha_registro ASC"
      delta_query = "SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_SEGVIDA_OFERTADOR_TAC WHERE fecha_registro > ? ORDER BY fecha_registro ASC"
      count_backfill_query = "SELECT count(1) as quantity, fecha_registro FROM (SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_SEGVIDA_OFERTADOR_TAC) query GROUP BY fecha_registro"
      count_delta_query = "SELECT count(1) as quantity, fecha_registro FROM (SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_SEGVIDA_OFERTADOR_TAC WHERE fecha_registro >= ?) query GROUP BY fecha_registro"
      deltaname = "fecha_registro"
      dbname = "DL_SI_DIM_VW"
      rut-field = "rut"
      tablename = "TMP_SEGVIDA_OFERTADOR_TAC"
    }
  }

  seguro-salud-campaign {
    jobname = "cargaSeguroSalud"
    consumer-conf { include "default-campaign-consumer.conf" }
    datasource {
      backfill_query = "SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_SEGSALUD_OFERTADOR_TAC ORDER BY fecha_registro ASC"
      delta_query = "SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_SEGSALUD_OFERTADOR_TAC WHERE fecha_registro > ? ORDER BY fecha_registro ASC"
      count_backfill_query = "SELECT count(1) as quantity, fecha_registro FROM (SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_SEGSALUD_OFERTADOR_TAC) query GROUP BY fecha_registro"
      count_delta_query = "SELECT count(1) as quantity, fecha_registro FROM (SELECT rut, fecha_registro FROM DL_SI_DIM_VW.TMP_SEGSALUD_OFERTADOR_TAC WHERE fecha_registro > ?) query GROUP BY fecha_registro"
      deltaname = "fecha_registro"
      dbname = "DL_SI_DIM_VW"
      rut-field = "rut"
      tablename = "TMP_SEGSALUD_OFERTADOR_TAC"
    }
  }

  traspaso-campaign {
    jobname = "cargaTraspaso"
    consumer-conf { include "default-campaign-consumer.conf" }
    datasource {
      backfill_query = "SELECT rut, fecha_registro, monto, tipo_producto FROM DL_SI_DIM_VW.TMP_TRASPASOTCTA_OFERTADOR_TAC ORDER BY fecha_registro ASC"
      delta_query = "SELECT rut, fecha_registro, monto, tipo_producto FROM DL_SI_DIM_VW.TMP_TRASPASOTCTA_OFERTADOR_TAC WHERE fecha_registro > ? ORDER BY fecha_registro ASC"
      count_backfill_query = "SELECT count(1) as quantity, fecha_registro FROM (SELECT rut, fecha_registro, monto, tipo_producto FROM DL_SI_DIM_VW.TMP_TRASPASOTCTA_OFERTADOR_TAC) query GROUP BY fecha_registro"
      count_delta_query = "SELECT count(1) as quantity, fecha_registro FROM (SELECT rut, fecha_registro, monto, tipo_producto FROM DL_SI_DIM_VW.TMP_TRASPASOTCTA_OFERTADOR_TAC WHERE fecha_registro > ?) query GROUP BY fecha_registro"
      deltaname = "fecha_registro"
      dbname = "DL_SI_DIM_VW"
      rut-field = "rut"
      tablename = "TMP_TRASPASOTCTA_OFERTADOR_TAC"
    }
  }
}
